---
Date: 2026-02-15
tags:
  - journal
---
# 2026-02-15

## Journal 

- `isoseter`: 
	- After generating the new set of mock images, conduct another round of `run_huang2013_campaign.py` in `/Users/mac/work/hsc/huang2013`.
- `isophote_test`: Fixed a subtle bug in the Poisson noise path: the sky background was being left in the output image. The code now adds the sky internally for correct photon statistics, then subtracts it, keeping the output sky-free as intended. 
	- Also decoupled sky_sb_value from sky_enabled in the CLI for cleaner separation of concerns, and added a --randomize-noise-seed flag (plumbed through ImageConfig, CLI, and YAML loader) so each mock run can produce unique noise realizations instead of being locked to a fixed seed. Both demo scripts were updated accordingly. In the second commit, the Huang2013 mock generator was improved significantly: replaced fixed 4000px images with size_factor=16 dynamic sizing so image dimensions scale with each galaxy's angular size (still capped at 4001px), deepened the sky surface brightness limit from 24.0 to 24.5 mag/arcsec^2 for more realistic HSC-like mocks, and added automatic 2x2 mosaic PNG generation per galaxy for quick visual QA. These two commits touched mockgal.py (+20/-5 lines) and inputs/generate_huang2013_mocks.py (+98/-18 lines). 
- `confeti`: Built the `confeti.masking` module and real galaxy demo. The masking pipeline has two stages: standard photutils detection (Background2D + detect_sources + deblend + dilate) for contaminants away from the galaxy, and an on-galaxy step for compact sources sitting on top of the target. The on-galaxy approach went through three iterations. First attempt used unsharp masking (Gaussian high-pass filter), which correctly detected point sources but also highlighted ESO 243-49's edge-on disc as a high-frequency feature — catastrophic over-masking (9.1% masked, only 35 isophote levels). Replaced it with small-box Background2D subtraction (no deblending), which models the galaxy as a smooth 2D surface and only reveals compact residuals. Tuning ESO 243-49 required box=4, filter=3, npixels=3 to catch a specific contaminant at (142, 138) that is only 4 connected pixels at 3.4 sigma; the critical insight was that filter_size >= 3 is mandatory to prevent the background from absorbing point sources. Added a dedicated on_galaxy_dilate_fwhm parameter (set to 10.0 for ESO 243-49) for more aggressive dilation around on-galaxy detections. The demo script, debug figures (plot_on_galaxy_debug showing a standard vs. small-box background comparison), and a comprehensive DESIGN.md with a parameter-tuning guide were organized in examples/example_real_galaxy/. Merged to main as commit 32c1d5a; 28/28 tests pass.
- `pho`: 
	-  Migrated entire codebase from GTK2 to GTK3 (Phases 1-6)
	  • Fixed a critical segfault by using the cairo context from the draw signal handler
	  • Updated all deprecated APIs (signals, widgets, monitor detection, drawing)
	  • All 50 tests passing, runtime verified with images

## Question

- Q: for the mock image generation, I need to understand how to convert the physical flux back to the ADU number of the raw image. 
## Idea

## TIL
- New tool: `vie` - https://github.com/atanunq/viu Terminal image viewer with native support for iTerm and Kitty.
- New tool: `pindrop` - https://github.com/watzon/pindrop A native macOS menu bar dictation app using local speech-to-text with WhisperKit.